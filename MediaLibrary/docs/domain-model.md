# MediaLibrary - ドメインモデル設計書

## 概要

MediaLibraryContextのドメインモデルを、ドメイン駆動設計の原則に基づいて設計します。

## エンティティ (Entities)

### Media（メディア）
写真または動画を表現する中心的な概念

**構成要素:**
- **識別子**: 各メディアを一意に特定するID
- **種類**: 写真または動画
- **ファイルパス**: デバイス内での保存場所
- **メタデータ**: 撮影日時、サイズ、場所などの詳細情報

**特徴:**
- 一意の識別子を持つ
- 一度作成されると変更されない

## 値オブジェクト (Value Objects)

### MediaID（メディア識別子）
メディアを一意に識別するための値

**構成要素:**
- **値**: 文字列形式の識別子

**制約:**
- 空の値は許可されない

### MediaType（メディア種類）
メディアの種類を表現

**値:**
- **写真**: 静止画像

### MediaMetadata（メディアメタデータ）
メディアに関連する基本情報

**構成要素:**
- **ファイル形式**: JPEG、MP4等の形式
- **撮影日時**: いつ撮影されたか

### MediaFormat（メディア形式）
ファイルの形式を表現

**写真形式:**
- JPEG: 標準的な写真形式
- PNG: 透明度を持つ画像形式
- HEIC: iOS標準の高効率形式


### Thumbnail（サムネイル）
一覧表示のためのメディア縮小画像

**構成要素:**
- **対象メディア**: 元となるメディアの識別子
- **画像データ**: 縮小された画像

### PhotoLibraryPermission（写真ライブラリ権限）
写真ライブラリへのアクセス権限を表現

**状態:**
- **未確認**: 権限状態が未確認
- **許可**: アクセスが許可されている
- **拒否**: アクセスが拒否されている

## 集約 (Aggregates)

### MediaLibrary（メディアライブラリ）
デバイスの写真ライブラリ全体を管理する中心的な概念

**管理する要素:**
- **写真一覧**: デバイスに保存されているすべての写真
- **権限状態**: 写真ライブラリへのアクセス権限

**提供する機能:**
- **写真取得**: デバイスから写真一覧を取得
- **写真表示**: 取得した写真を一覧で表示
- **権限管理**: 写真ライブラリアクセス権限の確認・要求

## ドメインサービス (Domain Services)

今回の設計では、複数の集約にまたがる複雑なドメインロジックがないため、ドメインサービスは定義していません。

## リポジトリ (Repository)

### MediaRepository（メディアリポジトリ）
メディアデータの取得を担当

**提供する機能:**
- **全メディア取得**: デバイスからすべてのメディアを取得

### ThumbnailRepository（サムネイルリポジトリ）
サムネイルデータの保存・取得を担当

**提供する機能:**
- **サムネイル取得**: メディアに基づくサムネイル取得
- **サムネイル保存**: 生成されたサムネイルの保存

## 集約の境界

```
Media（メディア集約）
├── Media（集約ルート）
└── Thumbnail（値オブジェクト）
```

## ドメインエラー

### MediaError（メディアエラー）
メディア関連のエラー

**エラー種類:**
- **無効な識別子**: 空または不正な識別子
- **メディア未発見**: 指定されたメディアが見つからない
- **未対応形式**: サポートされていないファイル形式
- **サムネイル生成失敗**: サムネイル作成に失敗
- **メディア読み込み失敗**: デバイスからのメディア取得に失敗

## 不変条件

### Media集約の不変条件
- **識別子の一意性**: メディアIDは一意である
- **ファイルパスの有効性**: ファイルパスは有効な形式である
- **サムネイルの整合性**: サムネイルは対応するメディアに属する

## 基本的なビジネスルール（暫定）

> **注意**: 以下のルールは暫定的なものであり、実装時に詳細な挙動を定義していきます。

### メディア管理
- メディアは一意の識別子を持つ
- メディアは撮影日時を基準にソートされる

### サムネイル
- サムネイルは一覧表示時に生成される
- サムネイルはキャッシュされる

## 他のコンテキストとの関係

### AssetTransferContext
- 将来的に、選択されたメディアを転送対象として提供する予定