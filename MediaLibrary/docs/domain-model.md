# MediaLibrary - ドメインモデル設計書

## 概要

MediaLibraryContextのドメインモデルを、ドメイン駆動設計の原則に基づいて設計します。

## エンティティ (Entities)

### Media（メディア）
写真または動画を表現する中心的な概念

**構成要素:**
- **識別子**: 各メディアを一意に特定するID
- **種類**: 写真または動画
- **ファイルパス**: デバイス内での保存場所
- **メタデータ**: 撮影日時、サイズ、場所などの詳細情報

**特徴:**
- 一意の識別子を持つ
- 一度作成されると変更されない

## 値オブジェクト (Value Objects)

### MediaID（メディア識別子）
メディアを一意に識別するための値

**構成要素:**
- **値**: 文字列形式の識別子

**制約:**
- 空の値は許可されない

### MediaType（メディア種類）
メディアの種類を表現

**値:**
- **写真**: 静止画像
- **動画**: 映像ファイル

### MediaMetadata（メディアメタデータ）
メディアに関連する基本情報

**構成要素:**
- **ファイル形式**: JPEG、MP4等の形式
- **撮影日時**: いつ撮影されたか

### MediaFormat（メディア形式）
ファイルの形式を表現

**写真形式:**
- JPEG: 標準的な写真形式
- PNG: 透明度を持つ画像形式
- HEIC: iOS標準の高効率形式

**動画形式:**
- MP4: 標準的な動画形式
- MOV: Apple標準の動画形式

### Thumbnail（サムネイル）
一覧表示のためのメディア縮小画像

**構成要素:**
- **対象メディア**: 元となるメディアの識別子
- **画像データ**: 縮小された画像

## 集約 (Aggregates)

### MediaLibrary（メディアライブラリ）
デバイスのメディアライブラリ全体を管理する中心的な概念

**管理する要素:**
- **メディア一覧**: デバイスに保存されているすべてのメディア

**提供する機能:**
- **メディア取得**: デバイスからメディア一覧を取得
- **メディア表示**: 取得したメディアを一覧で表示

## ドメインサービス (Domain Services)

### MediaLibraryService（メディアライブラリサービス）
メディアライブラリの操作を担当

**提供する機能:**
- **メディア読み込み**: デバイスからすべてのメディアを取得

### ThumbnailService（サムネイルサービス）
サムネイル生成・管理を担当

**提供する機能:**
- **サムネイル生成**: メディアから一覧表示用のサムネイルを作成
- **キャッシュ取得**: 既に生成されたサムネイルを取得

## リポジトリインターフェース (Repository Interfaces)

### MediaRepository（メディアリポジトリ）
メディアデータの取得を担当

**提供する機能:**
- **全メディア取得**: デバイスからすべてのメディアを取得

### ThumbnailRepository（サムネイルリポジトリ）
サムネイルデータの保存・取得を担当

**提供する機能:**
- **サムネイル取得**: メディアに基づくサムネイル取得
- **サムネイル保存**: 生成されたサムネイルの保存

## ドメインエラー

### MediaError（メディアエラー）
メディア関連のエラー

**エラー種類:**
- **無効な識別子**: 空または不正な識別子
- **メディア未発見**: 指定されたメディアが見つからない
- **未対応形式**: サポートされていないファイル形式
- **サムネイル生成失敗**: サムネイル作成に失敗
- **メディア読み込み失敗**: デバイスからのメディア取得に失敗

## 集約の境界

```
MediaLibrary（メディアライブラリ集約）
├── Media（メディア）
└── Thumbnail（サムネイル）
```

## 不変条件

### MediaLibrary集約の不変条件
- **メディア一意性**: 同じメディアが重複して存在しない

### Media エンティティの不変条件
- **識別子の一意性**: メディアIDは一意である
- **ファイルパスの有効性**: ファイルパスは有効な形式である

## 基本的なビジネスルール（暫定）

> **注意**: 以下のルールは暫定的なものであり、実装時に詳細な挙動を定義していきます。

### メディア管理
- メディアは一意の識別子を持つ
- メディアは撮影日時を基準にソートされる

### サムネイル
- サムネイルは一覧表示時に生成される
- サムネイルはキャッシュされる

## 他のコンテキストとの関係

### AssetTransferContext
- 将来的に、選択されたメディアを転送対象として提供する予定