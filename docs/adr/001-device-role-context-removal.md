# ADR-001: DeviceRoleContextの削除とシンプルな転送機能への回帰

## ステータス

採用済み

## 日付

2025-07-11

## コンテキスト

Issue #3において、DeviceRole機能の実装を検討する中で、以下の課題が明らかになった：

### 当初の設計案
- アプリ起動時にデバイスの役割（送信者/受信者）を選択
- 選択した役割を永続化（UserDefaults）
- 役割に応じたUIの表示切り替え
- 独立したDeviceRoleContextの実装

### 発見された問題

1. **ビジネス価値の不明確さ**
   - 「送信者」「受信者」は技術的な役割であり、ユーザーの真の目的を表現していない
   - ユーザーの実際の目的は「容量を空ける」「写真を保管する」

2. **役割の固定化による柔軟性の欠如**
   - 実際の使用では、両方のデバイスで容量管理が必要
   - 状況に応じて転送方向が変わる可能性がある
   - 手元にある古いデバイスを操作したい場合、そのデバイスが「整理する側」になる

3. **複雑な所有概念とSSOTの問題**
   - 写真の「所有」をどう定義するかの複雑性
   - 移動後のサムネイル管理による混乱
   - Single Source of Truth（SSOT）の管理が困難
   - 古いiPhoneが常時稼働していない前提での閲覧体験の問題

4. **ユーザー体験との齟齬**
   - 実際のユーザーは手元のデバイスを操作したがる
   - 固定的な役割はユーザーの直感的な操作と合わない

## 決定

以下の変更を行う：

1. **DeviceRoleContextを完全に削除**
   - 独立したコンテキストとしては実装しない
   - 固定的な役割管理は行わない

2. **AssetTransferContextに転送時役割を統合**
   - 転送時の一時的な役割（Sender/Receiver）のみを管理
   - 転送セッション中のみ有効

3. **シンプルな転送機能への特化**
   - 純粋な「写真引っ越しアプリ」として設計
   - AirDropの使いづらさを解決することに集中

4. **動的な機能選択方式**
   - アプリ起動時：メイン画面（共通UI）を表示
   - ユーザーが「写真を送る」「写真を受け取る」を選択
   - 選択に応じて一時的に役割が決定

5. **サムネイル機能の削除**
   - データ管理の複雑性を回避
   - 「移動 = 完全な引っ越し」として明確化
   - 代替として移動履歴の記録を実装

## 影響

### ポジティブな影響
- **アーキテクチャの簡素化**: パッケージ数が6つから5つに削減
- **ユーザー体験の向上**: 直感的な操作フローの実現
- **実装の簡素化**: 複雑な状態管理が不要
- **保守性の向上**: 理解しやすい設計

### 削除される機能
- DeviceRoleContext全体
- 起動時の役割選択画面
- 役割の永続化機能
- 固定的な役割別UI
- サムネイル閲覧機能

### 新しく実装される機能
- AssetTransferContext内での一時的な役割管理
- メイン画面からの動的な機能選択
- シンプルな転送フロー
- 移動履歴の記録

## 差別化ポイント

PhotoMoveは以下の点で他のファイル転送アプリと差別化する：

1. **容量最適化への特化**
   - 移動前に「◯◯GB節約できます」を表示
   - 容量の大きいファイルを優先表示
   - ストレージ残量アラート

2. **SystemMonitoringContextとの連携**
   - ストレージ容量の監視・分析
   - プロアクティブな整理提案

## 結果

この決定により、PhotoMoveは「複雑な役割管理を持つアプリ」から「シンプルで直感的な写真引っ越しアプリ」へと進化した。ユーザーの真の目的である「容量問題の解決」に焦点を当て、必要最小限の機能で最大の価値を提供する設計となった。

## 関連する決定

- ADR-002: 転送時役割の実装方針（予定）
- ADR-003: 移動履歴機能の設計（予定）